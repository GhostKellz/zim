# ZIM CLI Reference

Complete command-line reference for ZIM - Zig Infrastructure Manager.

## Table of Contents

- [Global Options](#global-options)
- [Toolchain Commands](#toolchain-commands)
- [Dependency Commands](#dependency-commands)
- [Target Commands](#target-commands)
- [Cache Commands](#cache-commands)
- [Policy Commands](#policy-commands)
- [Utility Commands](#utility-commands)

---

## Global Options

Available with all commands:

```bash
--json              Output in JSON format
--verbose, -v       Enable verbose output
--quiet, -q         Minimal output (errors only)
--cache-dir <dir>   Override default cache directory
--config <file>     Use specific config file
--help, -h          Show help message
--version           Show version information
```

**Examples:**
```bash
zim --json deps graph              # JSON output
zim --verbose install 0.16.0       # Verbose installation
zim --cache-dir /tmp/zim deps fetch  # Custom cache location
```

---

## Toolchain Commands

Manage Zig compiler versions (like rustup for Rust).

### `zim toolchain list`

List all installed Zig toolchains.

```bash
zim toolchain list
```

**Output:**
```
Installed Zig toolchains:

  0.16.0 (active)
  0.13.0
  0.12.1

Local custom toolchains:
  (none)
```

### `zim toolchain install <version>`

Install a specific Zig version.

```bash
zim toolchain install 0.16.0
zim toolchain install 0.13.0
```

**Shorthand:**
```bash
zim install 0.16.0
```

**What it does:**
1. Downloads from ziglang.org
2. Verifies hash with zcrypto
3. Extracts to `~/.zim/toolchains/<version>`
4. Makes available for use

### `zim toolchain use <version>`

Set global active Zig version.

```bash
zim toolchain use 0.16.0
```

**Shorthand:**
```bash
zim use 0.16.0
```

**Creates:**
- Symlink at `~/.zim/toolchains/active` → `0.16.0`
- Or on Windows: writes to `active.txt`

### `zim toolchain pin <version>`

Pin project to specific Zig version.

```bash
zim toolchain pin 0.16.0
```

**Creates:** `.zim/toolchain.toml` in current directory:
```toml
# ZIM toolchain configuration
# Generated by: zim toolchain pin 0.16.0

zig = "0.16.0"

# Uncomment to add cross-compilation targets
# targets = ["x86_64-linux-gnu", "aarch64-linux-gnu", "wasm32-wasi"]
```

---

## Dependency Commands

Manage project dependencies (like cargo for Rust, npm for Node.js).

### `zim deps init [name]`

Initialize new project with dependency manifest.

```bash
zim deps init my-project
```

**Creates:** `zim.toml`:
```toml
# ZIM project manifest

[project]
name = "my-project"
version = "0.1.0"
zig = "0.16.0"

[dependencies]
# Add dependencies here
# example = { git = "https://github.com/user/repo", ref = "main" }
# other = { tarball = "https://example.com/package.tar.gz", hash = "sha256:..." }

[dev-dependencies]
# Development dependencies

[targets]
# Cross-compilation targets
default = ["native"]
```

### `zim deps add <spec>`

Add a dependency to the project.

```bash
# Git dependency
zim deps add zsync --git https://github.com/user/zsync --ref main

# Tarball dependency
zim deps add package --tarball https://example.com/pkg.tar.gz --hash sha256:abc123

# Local dependency
zim deps add mylib --local /path/to/mylib

# Registry dependency (future)
zim deps add zhttp@0.1.4
```

### `zim deps fetch`

Fetch and cache all dependencies.

```bash
zim deps fetch
```

**What it does:**
1. Reads `zim.toml` manifest
2. Resolves dependency graph
3. Downloads to content-addressed cache
4. Verifies hashes with zcrypto
5. Creates/updates `zim.lock` lockfile

**Cache structure:**
```
~/.cache/zim/deps/
├── ab/
│   └── cd/
│       └── abcdef1234567890...
└── 12/
    └── 34/
        └── 1234567890abcdef...
```

### `zim deps graph`

Display dependency tree.

```bash
zim deps graph
```

**Output:**
```
Dependency graph:

  zsync @ 0.7.1
    └── zlog
  zhttp @ 0.1.4
    └── zsync

Total: 2 direct dependencies
```

### `zim deps update [package]`

Update dependencies to latest versions.

```bash
zim deps update           # Update all
zim deps update zsync     # Update specific package
```

---

## Target Commands

Manage cross-compilation targets.

### `zim target add <triple>`

Add a cross-compilation target.

```bash
zim target add x86_64-linux-gnu
zim target add aarch64-linux-gnu
zim target add wasm32-wasi
```

**Output:**
```
Adding target: wasm32-wasi
✓ Target wasm32-wasi added successfully
  Architecture: wasm32
  OS: wasi

✓ Standard library is available (bundled with Zig toolchain)
  For custom sysroot/libc headers, place them in: /home/user/.zim/targets/wasm32-wasi
```

### `zim target list`

List installed targets.

```bash
zim target list
```

**Output:**
```
Installed cross-compilation targets:

  wasm32-wasi
  aarch64-linux-gnu

Common targets:
  x86_64-linux-gnu       - Linux x86_64
  aarch64-linux-gnu      - Linux ARM64
  x86_64-windows-gnu     - Windows x86_64
  x86_64-macos           - macOS x86_64
  aarch64-macos          - macOS ARM64 (Apple Silicon)
  wasm32-wasi            - WebAssembly WASI
  wasm32-freestanding    - WebAssembly bare
```

### `zim target remove <triple>`

Remove a target.

```bash
zim target remove wasm32-wasi
```

---

## Cache Commands

Manage dependency cache.

### `zim cache status`

Show cache statistics.

```bash
zim cache status
```

**Output:**
```
Cache status:
  Location: /home/user/.cache/zim
  (Detailed statistics not yet implemented)
```

### `zim cache prune [--dry-run]`

Remove unused cache entries.

```bash
zim cache prune            # Actually prune
zim cache prune --dry-run  # Preview what would be deleted
```

### `zim cache doctor`

Verify cache integrity.

```bash
zim cache doctor
```

---

## Policy Commands

Security and policy enforcement.

### `zim policy audit`

Audit dependencies against policy.

```bash
zim policy audit
```

### `zim verify`

Verify project integrity (checksums, signatures).

```bash
zim verify
```

**Output:**
```
Verifying project integrity...

Verifying dependencies...
  Verifying zsync... ✓
  Verifying zhttp... ✓

✓ Verified 2 dependencies

✓ All integrity checks passed
```

---

## Utility Commands

### `zim doctor`

Run system diagnostics.

```bash
zim doctor
```

**Checks:**
- TLS/CA configuration
- Network connectivity
- Toolchain installations
- Cache health

### `zim version`

Show version information.

```bash
zim version
```

**Output:**
```
zim 0.1.0-dev
Zig Infrastructure Manager
Zig version: 0.16.0-dev.1225+bf9082518
```

### `zim help`

Show help message.

```bash
zim help
zim <command> --help
```

---

## Configuration Files

### Project Configuration: `.zim/toolchain.toml`

```toml
# ZIM toolchain configuration
zig = "0.16.0"

# Cross-compilation targets
targets = ["x86_64-linux-gnu", "wasm32-wasi"]
```

### Global Configuration: `~/.config/zim/config.toml`

```toml
[cache]
dir = "/custom/cache/dir"
max_size = 10737418240  # 10GB

[registry]
url = "https://zim.example.com/registry"
mirror = "https://mirror.example.com"

[policy]
require_signatures = true
allowed_sources = ["github.com", "gitlab.com"]
denied_sources = []

[network]
ca_bundle = "/etc/ssl/certs/ca-bundle.crt"
```

### Dependency Manifest: `zim.toml`

```toml
[project]
name = "my-project"
version = "1.0.0"
zig = "0.16.0"

[dependencies]
zsync = { git = "https://github.com/user/zsync", ref = "main" }
zhttp = { tarball = "https://example.com/zhttp.tar.gz", hash = "sha256:abc123..." }
mylib = { path = "/path/to/mylib" }

[dev-dependencies]
test-framework = { git = "https://github.com/user/test", ref = "v1.0.0" }

[targets]
default = ["native", "wasm32-wasi"]
```

### Lockfile: `zim.lock`

```toml
# ZIM dependency lockfile
# This file is automatically generated. Do not edit manually.

# zsync = 0.7.1
# zhttp = 0.1.4
```

---

## Environment Variables

```bash
ZIM_CACHE_DIR         Override cache directory
ZIM_TOOLCHAIN_DIR     Override toolchain directory
ZIM_CA_BUNDLE         Custom CA bundle for TLS
SSL_CERT_FILE         Fallback CA bundle path
ZIM_REGISTRY_URL      Custom registry URL
ZIM_REQUIRE_SIGNATURES  Require package signatures (true/false)
```

**Example:**
```bash
export ZIM_CACHE_DIR=/tmp/zim-cache
export ZIM_REQUIRE_SIGNATURES=true
zim deps fetch
```

---

## Exit Codes

```
0   Success
1   General error
2   Invalid arguments
3   Network error
4   Hash verification failed
5   Conflict detected
```

---

## Examples

### Complete Project Setup

```bash
# Install Zig
zim install 0.16.0
zim use 0.16.0

# Initialize project
zim deps init my-awesome-project
cd my-awesome-project

# Add dependencies
zim deps add zsync --git https://github.com/user/zsync
zim deps add zhttp --git https://github.com/user/zhttp

# Fetch dependencies
zim deps fetch

# Add cross-compilation target
zim target add wasm32-wasi

# Verify everything
zim verify

# Build your project
zig build
```

### Switch Between Zig Versions

```bash
# Install multiple versions
zim install 0.16.0
zim install 0.13.0

# Switch globally
zim use 0.13.0

# Or pin to project
cd my-project
zim pin 0.16.0
```

### Monorepo Workflow

```bash
# Workspace root
zim deps init workspace
cd workspace

# Add multiple packages
mkdir packages/lib1 packages/lib2
cd packages/lib1
zim deps init lib1

cd ../lib2
zim deps init lib2

# Fetch all
cd ../..
zim deps fetch
```

---

## See Also

- [API Documentation](API.md)
- [Configuration Guide](CONFIGURATION.md)
- [README](../README.md)
